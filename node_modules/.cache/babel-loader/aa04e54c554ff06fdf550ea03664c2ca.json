{"ast":null,"code":"import _toConsumableArray from\"/home/carlo/work/curr/jitsi-bubble/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/carlo/work/curr/jitsi-bubble/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/home/carlo/work/curr/jitsi-bubble/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/carlo/work/curr/jitsi-bubble/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";/* global JitsiMeetJS config*/import React,{useState,useCallback,useEffect,useMemo}from'react';import'./App.css';import BubbleContainer from'./bubbleContainer.js';import $ from'jquery';import{Seat}from'./components/Seat';import{ConnectForm}from'./components/ConnectForm';import{Audio}from'./components/Audio';import useWindowSize from'./hooks/useWindowSize';import qs from'qs';window.$=$;var connect=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref){var domain,room,config,connectionConfig,serviceUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:domain=_ref.domain,room=_ref.room,config=_ref.config;connectionConfig=Object.assign({},config);serviceUrl=connectionConfig.websocket||connectionConfig.bosh;serviceUrl+=\"?room=\".concat(room);connectionConfig.serviceUrl=connectionConfig.bosh=serviceUrl;return _context.abrupt(\"return\",new Promise(function(resolve,reject){var connection=new JitsiMeetJS.JitsiConnection(null,undefined,connectionConfig);console.log('JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED',JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED);connection.addEventListener(JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED,function(){return resolve(connection);});connection.addEventListener(JitsiMeetJS.events.connection.CONNECTION_FAILED,reject);connection.connect();}));case 6:case\"end\":return _context.stop();}}},_callee);}));return function connect(_x){return _ref2.apply(this,arguments);};}();var join=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3){var connection,room,conference;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:connection=_ref3.connection,room=_ref3.room;conference=connection.initJitsiConference(room,{});return _context2.abrupt(\"return\",new Promise(function(resolve){conference.on(JitsiMeetJS.events.conference.CONFERENCE_JOINED,function(){return resolve(conference);});conference.join();}));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function join(_x2){return _ref4.apply(this,arguments);};}();var connectandJoin=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref5){var domain,room,config,connection,localTracks,conference,localTrack,localAudioTrack;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:domain=_ref5.domain,room=_ref5.room,config=_ref5.config;_context3.next=3;return connect({domain:domain,room:room,config:config});case 3:connection=_context3.sent;_context3.next=6;return JitsiMeetJS.createLocalTracks({devices:['video','audio'],facingMode:'user'},true);case 6:localTracks=_context3.sent;_context3.next=9;return join({connection:connection,room:room});case 9:conference=_context3.sent;localTrack=localTracks.find(function(track){return track.getType()==='video';});conference.addTrack(localTrack);localAudioTrack=localTracks.find(function(track){return track.getType()==='audio';});conference.addTrack(localAudioTrack);return _context3.abrupt(\"return\",{connection:connection,conference:conference,localTrack:localTrack});case 15:case\"end\":return _context3.stop();}}},_callee3);}));return function connectandJoin(_x3){return _ref6.apply(this,arguments);};}();var loadAndConnect=function loadAndConnect(_ref7){var domain=_ref7.domain,room=_ref7.room;return new Promise(function(resolve){var script=document.createElement('script');script.onload=function(){JitsiMeetJS.init();var configScript=document.createElement('script');configScript.src=\"https://\".concat(domain,\"/config.js\");document.querySelector('head').appendChild(configScript);configScript.onload=function(){connectandJoin({domain:domain,room:room,config:config}).then(resolve);};};script.src=\"https://\".concat(domain,\"/libs/lib-jitsi-meet.min.js\");document.querySelector('head').appendChild(script);});};var BUBBLECOLLECTION;var MAP={};var DEFINED=false;function RAF(){window.requestAnimationFrame(RAF);BUBBLECOLLECTION.doStep();}function plippo(track){if(!BUBBLECOLLECTION){BUBBLECOLLECTION=new BubbleContainer(document.getElementById(\"container\"));}var VIDEO=document.createElement(\"video\");VIDEO.style.height=\"100%\";VIDEO.style.flexShrink=\"0\";VIDEO.style.center=\"center\";VIDEO.autoplay='1';track.attach(VIDEO);if(typeof MAP[track.getId()]==='undefined'){MAP[track.getId()]=VIDEO;BUBBLECOLLECTION.insert(VIDEO);}if(DEFINED===false){DEFINED=true;RAF();}}var useTracks=function useTracks(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),tracks=_useState2[0],setTracks=_useState2[1];var addTrack=useCallback(function(track){setTracks(function(tracks){var hasTrack=tracks.find(function(_track){return track.getId()===_track.getId();});if(hasTrack)return tracks;if(track.getType()===\"video\"){plippo(track);}return[].concat(_toConsumableArray(tracks),[track]);});},[setTracks]);var removeTrack=useCallback(function(track){if(track.getType()===\"video\")if(BUBBLECOLLECTION)if(typeof MAP[track.getId()]!=='undefined'){BUBBLECOLLECTION.erase(MAP[track.getId()]);MAP[track.getId()]=undefined;}setTracks(function(tracks){return tracks.filter(function(_track){return track.getId()!==_track.getId();});});},[setTracks]);return[tracks,addTrack,removeTrack];};var getDefaultParamsValue=function getDefaultParamsValue(){var _params$room,_params$domain,_params$autojoin;var params=document.location.search.length>1?qs.parse(document.location.search.slice(1)):{};debugger;return{room:(_params$room=params.room)!==null&&_params$room!==void 0?_params$room:'daily_standup',domain:(_params$domain=params.domain)!==null&&_params$domain!==void 0?_params$domain:'meet.jit.si',autoJoin:(_params$autojoin=params.autojoin)!==null&&_params$autojoin!==void 0?_params$autojoin:false};};function App(){useWindowSize();var defaultParams=useMemo(getDefaultParamsValue,[]);var _useState3=useState('init'),_useState4=_slicedToArray(_useState3,2),mainState=_useState4[0],setMainState=_useState4[1];var _useState5=useState(defaultParams.domain),_useState6=_slicedToArray(_useState5,2),domain=_useState6[0],setDomain=_useState6[1];var _useState7=useState(defaultParams.room),_useState8=_slicedToArray(_useState7,2),room=_useState8[0],setRoom=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),conference=_useState10[0],setConference=_useState10[1];var _useTracks=useTracks(),_useTracks2=_slicedToArray(_useTracks,3),videoTracks=_useTracks2[0],addVideoTrack=_useTracks2[1],removeVideoTrack=_useTracks2[2];var _useTracks3=useTracks(),_useTracks4=_slicedToArray(_useTracks3,3),audioTracks=_useTracks4[0],addAudioTrack=_useTracks4[1],removeAudioTrack=_useTracks4[2];var addTrack=useCallback(function(track){if(track.getType()==='video'){addVideoTrack(track);}if(track.getType()==='audio')addAudioTrack(track);},[addVideoTrack,addAudioTrack]);var removeTrack=useCallback(function(track){if(track.getType()==='video')removeVideoTrack(track);if(track.getType()==='audio')removeAudioTrack(track);},[removeAudioTrack,removeVideoTrack]);var connect=useCallback(/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var _yield$loadAndConnect,connection,conference,localTrack;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:e&&e.preventDefault();setMainState('loading');_context4.next=4;return loadAndConnect({domain:domain,room:room});case 4:_yield$loadAndConnect=_context4.sent;connection=_yield$loadAndConnect.connection;conference=_yield$loadAndConnect.conference;localTrack=_yield$loadAndConnect.localTrack;setMainState('started');setConference(conference);addTrack(localTrack);case 11:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref8.apply(this,arguments);};}(),[addTrack,domain,room]);useEffect(function(){if(!conference)return;conference.on(JitsiMeetJS.events.conference.TRACK_ADDED,addTrack);conference.on(JitsiMeetJS.events.conference.TRACK_REMOVED,removeTrack);},[addTrack,conference,removeTrack]);useEffect(function(){if(defaultParams.autoJoin||defaultParams.autoJoin===''){connect();}},[connect,defaultParams.autoJoin]);return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(\"header\",{className:\"App-header\"},mainState==='init'&&/*#__PURE__*/React.createElement(ConnectForm,{connect:connect,domain:domain,room:room,setRoom:setRoom,setDomain:setDomain}),mainState==='loading'&&'Loading',mainState==='started'&&/*#__PURE__*/React.createElement(\"div\",{id:\"container\",style:{height:'100vh',width:'100vw',maxHeight:'100vw',maxWidth:'100vh',background:'rgba(0, 100,100, 1)',position:'relative'}},\"}\",audioTracks.map(function(track,index){return/*#__PURE__*/React.createElement(Audio,{track:track,index:index,key:track.getId()});}))));}export default App;","map":{"version":3,"sources":["/home/carlo/work/curr/jitsi-bubble/src/App.js"],"names":["React","useState","useCallback","useEffect","useMemo","BubbleContainer","$","Seat","ConnectForm","Audio","useWindowSize","qs","window","connect","domain","room","config","connectionConfig","Object","assign","serviceUrl","websocket","bosh","Promise","resolve","reject","connection","JitsiMeetJS","JitsiConnection","undefined","console","log","events","CONNECTION_ESTABLISHED","addEventListener","CONNECTION_FAILED","join","conference","initJitsiConference","on","CONFERENCE_JOINED","connectandJoin","createLocalTracks","devices","facingMode","localTracks","localTrack","find","track","getType","addTrack","localAudioTrack","loadAndConnect","script","document","createElement","onload","init","configScript","src","querySelector","appendChild","then","BUBBLECOLLECTION","MAP","DEFINED","RAF","requestAnimationFrame","doStep","plippo","getElementById","VIDEO","style","height","flexShrink","center","autoplay","attach","getId","insert","useTracks","tracks","setTracks","hasTrack","_track","removeTrack","erase","filter","getDefaultParamsValue","params","location","search","length","parse","slice","autoJoin","autojoin","App","defaultParams","mainState","setMainState","setDomain","setRoom","setConference","videoTracks","addVideoTrack","removeVideoTrack","audioTracks","addAudioTrack","removeAudioTrack","e","preventDefault","TRACK_ADDED","TRACK_REMOVED","width","maxHeight","maxWidth","background","position","map","index"],"mappings":"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","sourcesContent":["/* global JitsiMeetJS config*/\nimport React, { useState, useCallback, useEffect, useMemo } from 'react';\nimport './App.css';\nimport BubbleContainer from './bubbleContainer.js'\nimport $ from 'jquery'\nimport { Seat } from './components/Seat';\nimport { ConnectForm } from './components/ConnectForm';\nimport { Audio } from './components/Audio';\nimport useWindowSize from './hooks/useWindowSize'\n\nimport qs from 'qs'\n\nwindow.$  = $\n\nconst connect = async ({ domain, room, config }) => {\n  const connectionConfig = Object.assign({}, config);\n  let serviceUrl = connectionConfig.websocket || connectionConfig.bosh;\n\n  serviceUrl += `?room=${room}`;\n\n  connectionConfig.serviceUrl = connectionConfig.bosh = serviceUrl;\n  \n  return new Promise((resolve, reject) => {\n    const connection = new JitsiMeetJS.JitsiConnection(null, undefined, connectionConfig);\n    console.log('JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED', JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED)\n    connection.addEventListener(\n      JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED,\n      () => resolve(connection));\n    connection.addEventListener(JitsiMeetJS.events.connection.CONNECTION_FAILED, reject);\n    connection.connect();\n  }) \n}\n\nconst join = async ({ connection, room }) => {\n  const conference = connection.initJitsiConference(room, {});\n\n  return new Promise(resolve => {\n    conference.on(JitsiMeetJS.events.conference.CONFERENCE_JOINED, () => resolve(conference));\n    conference.join();\n  })\n}\n\nconst connectandJoin = async ({ domain, room, config }) => {\n\n  const connection = await connect({ domain, room, config })\n  const localTracks = await JitsiMeetJS.createLocalTracks({ devices: ['video', 'audio'], facingMode: 'user'}, true);\n\n  const conference = await join({ connection, room })\n  const localTrack = localTracks.find(track => track.getType() === 'video')\n  conference.addTrack(localTrack)\n  const localAudioTrack = localTracks.find(track => track.getType() === 'audio')\n  conference.addTrack(localAudioTrack)\n\n  return { connection, conference, localTrack }\n}\n\nconst loadAndConnect = ({ domain, room}) => {\n\n    return new Promise(( resolve ) => {\n      const script = document.createElement('script')\n      script.onload = () => {\n        JitsiMeetJS.init();\n\n        const configScript = document.createElement('script')\n        configScript.src = `https://${domain}/config.js`;\n        document.querySelector('head').appendChild(configScript);\n        configScript.onload = () => {\n          connectandJoin({ domain, room, config }).then(resolve)\n        }       \n      };\n\n      script.src = `https://${domain}/libs/lib-jitsi-meet.min.js`;\n      document.querySelector('head').appendChild(script);\n    })\n}\n\nvar BUBBLECOLLECTION;\nvar MAP = {};\nvar DEFINED = false;\nfunction RAF() \n{\n        window.requestAnimationFrame(RAF);\n        BUBBLECOLLECTION.doStep();\n}\nfunction plippo(track) \n\t{\n\n if (!BUBBLECOLLECTION) {\n     \tBUBBLECOLLECTION = new BubbleContainer(document.getElementById(\"container\"));\n}\n\n\tvar VIDEO = document.createElement(\"video\");\n\tVIDEO.style.height = \"100%\";\n\tVIDEO.style.flexShrink = \"0\";\n\tVIDEO.style.center = \"center\";\n\tVIDEO.autoplay = '1';\n\ttrack.attach(VIDEO);\n\tif (typeof MAP[track.getId()] === 'undefined')\n\t\t{\n\t\tMAP[track.getId()] = VIDEO;\n      \t   BUBBLECOLLECTION.insert(VIDEO);\n\t\t}\nif (DEFINED === false)\n{\nDEFINED = true;\nRAF();\n}\n\t}\n\nconst useTracks = () => {\n  const [tracks, setTracks] = useState([])\n  \n  const addTrack = useCallback((track) => {\n    setTracks((tracks) => {\n      const hasTrack = tracks.find(_track => track.getId() === _track.getId())\n      \n      if(hasTrack) return tracks;\n\n\n      if (track.getType() === \"video\")\n      {\n      \tplippo(track);\n\t}\n     return [...tracks, track];\n    });\n  }, [setTracks])\n\n  const removeTrack = useCallback((track) => {\n\n\t\t  if (track.getType() === \"video\")\n\t\t  \tif (BUBBLECOLLECTION)\n\t\t\t\tif (typeof MAP[track.getId()] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\tBUBBLECOLLECTION.erase(MAP[track.getId()]);\n\t\t\t\t\tMAP[track.getId()] = undefined;\n\t\t\t\t\t}\n\t\t\t\t  \t\n\n    setTracks((tracks) => tracks.filter(_track => track.getId() !== _track.getId()));\n  }, [setTracks])\n\n  return [tracks, addTrack, removeTrack]\n}\n\nconst getDefaultParamsValue = () => {\n  const params = document.location.search.length > 1 ? qs.parse(document.location.search.slice(1)) : {}\n  debugger;\n  return {\n    room: params.room ?? 'daily_standup',\n    domain: params.domain ?? 'meet.jit.si',\n    autoJoin: params.autojoin ?? false,\n  }\n}\n\n\nfunction App() {\n\n  useWindowSize()\n  const defaultParams = useMemo(getDefaultParamsValue, [])\n\n  const [mainState, setMainState] = useState('init')\n  const [domain, setDomain] = useState(defaultParams.domain)\n  const [room, setRoom] = useState(defaultParams.room)\n  const [conference, setConference] = useState(null)\n  const [videoTracks, addVideoTrack, removeVideoTrack] = useTracks();\n  const [audioTracks, addAudioTrack, removeAudioTrack] = useTracks();\n  \n  const addTrack = useCallback((track) => {\n    if(track.getType() === 'video') \n    {\n    addVideoTrack(track);\n    }\n    if(track.getType() === 'audio') addAudioTrack(track)\n  }, [ addVideoTrack, addAudioTrack ])\n\n  const removeTrack = useCallback((track) => {\n    if(track.getType() === 'video') removeVideoTrack(track)\n    if(track.getType() === 'audio') removeAudioTrack(track)\n  }, [removeAudioTrack, removeVideoTrack])\n\n  const connect = useCallback(async (e) => {\n    e && e.preventDefault()\n    setMainState('loading')\n    const { connection, conference, localTrack } = await loadAndConnect({ domain, room });\n    setMainState('started')\n    setConference(conference)\n    addTrack(localTrack)\n  }, [addTrack, domain, room]);\n\n  useEffect(() => {\n    if(!conference) return\n\n    conference.on(JitsiMeetJS.events.conference.TRACK_ADDED, addTrack)\n    conference.on(JitsiMeetJS.events.conference.TRACK_REMOVED, removeTrack)\n    \n  }, [addTrack, conference, removeTrack])\n\n  useEffect(() => {\n    if(defaultParams.autoJoin || defaultParams.autoJoin === ''){\n      connect()\n    }\n  }, [connect, defaultParams.autoJoin])\n\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        { mainState === 'init' && <ConnectForm connect={connect} domain={domain} room={room} setRoom={setRoom} setDomain={setDomain} /> }\n        { mainState === 'loading' && 'Loading' }\n        { mainState === 'started' &&\n        <div id=\"container\" style={{\n          height: '100vh', width: '100vw', maxHeight: '100vw', maxWidth: '100vh',\n          background: 'rgba(0, 100,100, 1)',\n          position: 'relative'\n      }}>\n}\n        {\n     //     videoTracks.map((track, index) => <Seat track={track} xPos={Math.random()} yPos={Math.random()} seatSize={0.3} length={videoTracks.length} key={track.getId()} />)\n        }\n        {\n          audioTracks.map((track, index) => <Audio track={track} index={index} key={track.getId()} />)\n        }\n       </div>}\n        \n      </header>\n    </div>\n  );\n}\n\nexport default App;\n\n"]},"metadata":{},"sourceType":"module"}